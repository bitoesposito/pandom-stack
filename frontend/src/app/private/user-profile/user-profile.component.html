<app-nav-bar></app-nav-bar>

<main style="max-width: 1200px;" class="m-auto flex flex-column p-3 gap-3 mt-2">

    <p-tabs value="0">
        <p-tablist>
            <p-tab value="0">{{ 'profile.tabs.profile' | translate }}</p-tab>
            <p-tab value="1">{{ 'profile.tabs.settings' | translate }}</p-tab>
            <p-tab value="2" *ngIf="user?.role === 'admin'">{{ 'profile.tabs.administration' | translate }}</p-tab>
        </p-tablist>
        <p-tabpanels>
            <p-tabpanel value="0" class="flex md:flex-row flex-column gap-2 md:gap-3 w-full">
                <div class="flex flex-column gap-2 w-full">
                    <div class="flex gap-2 justify-content-between w-full">
                        <div class="flex flex-column">
                            <p class="text-color-secondary text-xs select-none">{{ 'user.logged-in-as' | translate }}</p>
                            <h4 class="sm:max-w-30rem max-w-13rem" style="white-space: nowrap; text-overflow: ellipsis; overflow: hidden; max-width: 10rem;" title="{{ user?.email }}">{{ user?.email }}</h4>
                            <small class="uppercase p-1 py-1 mt-1 surface-50 text-color-secondary border-round-xs select-none w-min border-1 surface-border">{{ user?.role }}</small>
                        </div>
    
                        <div class="flex flex-column align-items-end">
                            <p class="text-color-secondary opacity-70 text-xs select-none">{{ 'user.last-login' | translate }}</p>
                            <small class="text-color-secondary text-xs select-none">{{ user?.last_login_at | date:'dd/MM/yyyy HH:mm' }}</small>
                            <p class="text-color-secondary opacity-70 text-xs select-none mt-1">{{ 'user.created-at' | translate }}</p>
                            <small class="text-color-secondary text-xs select-none">{{ userProfile?.created_at | date:'dd/MM/yyyy' }}</small>
                        </div>
                    </div>

                    <hr class="surface-border my-1"/>

                    <div id="active-sessions" class="flex flex-column gap-2">
                        <p class="text-color-secondary text-xs select-none uppercase">{{ 'user.active-sessions' | translate }} ({{ activeSessionsCount }})</p>

                        <div class="border-1 surface-border border-round-md p-2 w-full">

                            @for (session of sessions; track session.id) {
                                <div *ngIf="session.is_active" class="flex flex-column">
                                    <p class="text-xs text-color-secondary select-none">{{ session.created_at | date:'dd/MM/yyyy HH:mm' }}</p>
                                    <p>{{ session.ip_address }}</p>
                                    <p class="text-xs text-color-secondary select-none text-xs" style="white-space: nowrap; text-overflow: ellipsis; overflow: hidden;" title="{{ session.user_agent }}">{{ session.user_agent }}</p>
                                </div>
                            }
                        </div>

                        <p-button styleClass="white-space-nowrap justify-content-start" fluid="true" [label]="'user.show-security-logs' | translate" icon="pi pi-shield" severity="secondary" outlined="true" (click)="toggleDialog('security')" />
                    </div>
                </div>

                <hr class="surface-border my-1"/>

                <div class="flex flex-column gap-2">
                    <p-button styleClass="white-space-nowrap justify-content-start" fluid="true" [label]="'user.edit-profile' | translate" icon="pi pi-pencil" severity="secondary" outlined="true" (click)="toggleDialog('edit')"/>
                    <p-button styleClass="white-space-nowrap justify-content-start" fluid="true" [label]="'user.download-data' | translate" icon="pi pi-download" severity="secondary" outlined="true" (click)="toggleDialog('download')" />
                    <p-button styleClass="white-space-nowrap justify-content-start" fluid="true" [label]="'user.change-password' | translate" icon="pi pi-key" severity="secondary" outlined="true"/>
                    <p-button styleClass="white-space-nowrap justify-content-start" fluid="true" [label]="'user.delete-account' | translate" icon="pi pi-trash" severity="danger" outlined="true" (click)="toggleDialog('delete')" />
                </div>
                
            </p-tabpanel>
            <p-tabpanel value="1">
                
            </p-tabpanel>
            <p-tabpanel value="2">
                
            </p-tabpanel>
        </p-tabpanels>
    </p-tabs>    
</main>

<p-dialog [header]="'profile.dialogs.edit-profile' | translate" [modal]="true" [(visible)]="isEditDialogVisible" [breakpoints]="{ '1199px': '75vw', '575px': '90vw' }" [style]="{ width: '50vw' }" [draggable]="false" [resizable]="false">
    <div class="flex flex-column gap-2">
    </div>
</p-dialog>

<p-dialog [header]="'profile.dialogs.download-data' | translate" [modal]="true" [(visible)]="isDownloadDialogVisible" [breakpoints]="{ '1199px': '75vw', '575px': '90vw' }" [style]="{ width: '50vw' }" [draggable]="false" [resizable]="false">
    <div class="flex flex-column gap-2">
    </div>
</p-dialog>

<p-dialog [header]="'profile.dialogs.delete-account' | translate" [modal]="true" [(visible)]="isDeleteDialogVisible" [breakpoints]="{ '1199px': '75vw', '575px': '90vw' }" [style]="{ width: '50vw' }" [draggable]="false" [resizable]="false">
    <div class="flex flex-column gap-2">
    </div>
</p-dialog>

<p-dialog [header]="'profile.dialogs.security-logs' | translate" [modal]="true" [(visible)]="isSecurityLogsDialogVisible" [breakpoints]="{ '1199px': '75vw', '575px': '90vw' }" [style]="{ width: '70vw' }" [draggable]="false" [resizable]="false">
    <div class="flex flex-column gap-2">
        <p class="text-color-secondary text-sm">{{ 'profile.security-logs.description' | translate }}</p>
    </div>
</p-dialog>